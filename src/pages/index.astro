---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import GameApp from "../components/GameApp";
import Header from "./header.astro";
import Footer from "./footer.astro";
import QuickGuide from "../components/QuickGuide.astro";
import LanguageSelector from "../components/LanguageSelector.astro";

const categoriesCollection = await getCollection("categories");

// Separate categories into international and national
const internationalCategories = categoriesCollection
  .filter((category) => category.id.startsWith("international/"))
  .map((category) => {
    // Remove "international/" prefix and .md extension
    const categoryId = category.id.replace(/^international\//, "").replace(/\.md$/, "");
    return {
      id: categoryId,
      words: Array.isArray(category.data.words) ? category.data.words : [],
      words_en: Array.isArray(category.data.words_en) ? category.data.words_en : [],
      hints: category.data.hints,
      hints_en: category.data.hints_en,
    };
  });

const nationalCategories = categoriesCollection
  .filter((category) => category.id.startsWith("national/"))
  .map((category) => {
    const categoryId = category.id.replace(/^national\/bolivian-/, "").replace(/\.md$/, "");
    return {
      id: categoryId,
      words: Array.isArray(category.data.words) ? category.data.words : [],
      words_en: Array.isArray(category.data.words_en) ? category.data.words_en : [],
      hints: category.data.hints,
      hints_en: category.data.hints_en,
    };
  });
---

<Layout>
  <LanguageSelector />
  <Header />
  <QuickGuide />
  <GameApp client:load internationalCategories={internationalCategories} nationalCategories={nationalCategories} />
  <Footer />
</Layout>
