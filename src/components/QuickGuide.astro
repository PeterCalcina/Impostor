---
import { getLanguage, getTranslations } from "../utils/i18n";

const lang = getLanguage();
const t = getTranslations(lang);
---

<div id="quick-guide-container" class="fixed top-5 right-5 z-50">
  <!-- BotÃ³n de informaciÃ³n -->
  <button
    id="quick-guide-toggle"
    class="w-8 h-8 bg-purple-600 hover:bg-purple-700 rounded-full flex items-center justify-center text-white shadow-lg hover:shadow-xl transition-all transform hover:scale-110 active:scale-95 cursor-pointer"
    aria-label="Toggle Quick Guide"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="2"
      stroke="currentColor"
      class="w-6 h-6"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"
      ></path>
    </svg>
  </button>

  <!-- Panel desplegable -->
  <div
    id="quick-guide-panel"
    class="hidden absolute top-16 right-0 w-80 max-w-[calc(100vw-2rem)] bg-slate-900/95 border border-slate-800 rounded-2xl p-6 text-sm shadow-2xl backdrop-blur-sm"
  >
    <h2 class="text-orange-400 font-bold mb-3 flex items-center gap-2">
      {t.quickGuide.title}
    </h2>
    <ul class="space-y-2 text-slate-300">
      <li class="flex gap-2">
        <span>1.</span>
        <span set:html={t.quickGuide.step1} />
      </li>
      <li class="flex gap-2">
        <span>2.</span>
        <span set:html={t.quickGuide.step2} />
      </li>
      <li class="flex gap-2">
        <span>3.</span>
        <span set:html={t.quickGuide.step3} />
      </li>
      <li class="flex gap-2">
        <span>4.</span>
        <span>{t.quickGuide.step4}</span>
      </li>
    </ul>
  </div>
</div>

<script>
  const translations = {
    es: {
      quickGuide: {
        title: "ðŸš€ GuÃ­a RÃ¡pida para Nuevos Jugadores:",
        step1: "Agrega al menos <b>3 jugadores</b>.",
        step2: "Elige una <b>categorÃ­a</b> y pasa el telÃ©fono.",
        step3: "Todos reciben la palabra secreta, <b>Â¡excepto el Impostor!</b>",
        step4: "Â¡Encuentra al mentiroso antes de que adivine la palabra!",
      },
    },
    en: {
      quickGuide: {
        title: "ðŸš€ Quick Guide for New Players:",
        step1: "Add at least <b>3 players</b>.",
        step2: "Pick a <b>category</b> and pass the phone around.",
        step3: "Everyone gets the secret word, <b>except the Impostor!</b>",
        step4: "Find the liar before they guess the word!",
      },
    },
  };

  function getLanguage() {
    const stored = localStorage.getItem("language");
    if (stored === "es" || stored === "en") return stored;
    const browserLang = navigator.language || (navigator as any).userLanguage;
    return browserLang.startsWith("es") ? "es" : "en";
  }

  function updateQuickGuideContent() {
    const lang = getLanguage();
    const t = translations[lang as "es" | "en"];
    const panel = document.getElementById("quick-guide-panel");

    if (panel) {
      const title = panel.querySelector("h2");
      const steps = panel.querySelectorAll("li span:last-child");

      if (title) title.textContent = t.quickGuide.title;
      if (steps[0]) steps[0].innerHTML = t.quickGuide.step1;
      if (steps[1]) steps[1].innerHTML = t.quickGuide.step2;
      if (steps[2]) steps[2].innerHTML = t.quickGuide.step3;
      if (steps[3]) steps[3].textContent = t.quickGuide.step4;
    }
  }

  const toggle = document.getElementById("quick-guide-toggle");
  const panel = document.getElementById("quick-guide-panel");

  if (toggle && panel) {
    toggle.addEventListener("click", () => {
      panel.classList.toggle("hidden");
    });

    // Cerrar al hacer clic fuera
    document.addEventListener("click", (e) => {
      const container = document.getElementById("quick-guide-container");
      if (
        container &&
        !container.contains(e.target as Node) &&
        !panel.classList.contains("hidden")
      ) {
        panel.classList.add("hidden");
      }
    });
  }

  // Actualizar contenido cuando cambie el idioma
  window.addEventListener("languageChanged", updateQuickGuideContent);
</script>

<style>
  #quick-guide-panel {
    animation: slideDown 0.3s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
